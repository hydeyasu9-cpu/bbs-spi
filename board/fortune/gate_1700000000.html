<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Access</title>
<style>
:root{
  --bg:#000;
  --panel:rgba(255,255,255,.06);
  --line:rgba(255,255,255,.14);
  --warn:#ffb74d;
  --accent:#2b90ff;
  --fade:260ms;
}
body{
  margin:0;
  background:var(--bg);
  color:#fff;
  font-family:system-ui,-apple-system,"Hiragino Sans","Noto Sans JP",sans-serif;
  min-height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
}
.wrap{
  width:min(920px,100%);
  padding:18px;
  box-sizing:border-box;
}

/* パスワード画面 */
.pw-screen{
  border-radius:16px;
  border:1px solid var(--line);
  background:var(--panel);
  padding:18px;
}
.pw-screen.hidden{ display:none; }

.row{
  display:flex;
  gap:10px;
}
input{
  flex:1;
  border-radius:14px;
  border:1px solid rgba(255,255,255,.18);
  background:rgba(0,0,0,.35);
  color:#fff;
  padding:14px;
  font-size:16px;
}
.go{
  border:none;
  border-radius:14px;
  padding:14px 16px;
  font-weight:900;
  background:#00c853;
  color:#06230f;
}
.locked{
  opacity:.4;
  pointer-events:none;
}
.msg{
  margin-top:10px;
  font-size:13px;
  color:var(--warn);
}

/* 動画 */
.stage{
  display:none;
  margin-top:12px;
  border-radius:16px;
  overflow:hidden;
  border:1px solid var(--line);
}
.stage.show{ display:block; }

video{
  width:100%;
  max-height:80vh;
  background:#000;
}

/* 再生ボタン */
.overlay{
  position:absolute;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  background:rgba(0,0,0,.75);
}
.overlay.hidden{ display:none; }

.btn{
  border:none;
  border-radius:14px;
  padding:14px 18px;
  font-size:16px;
  font-weight:900;
  background:var(--accent);
  color:#071a2f;
}

/* ブラックアウト */
.blackout{
  position:fixed;
  inset:0;
  background:#000;
  opacity:0;
  pointer-events:none;
  transition:opacity var(--fade) ease;
  z-index:9999;
}
.blackout.show{
  opacity:1;
  pointer-events:auto;
}
</style>
</head>
<body>

<div class="blackout" id="blackout"></div>

<div class="wrap">

  <!-- 初期：パスワード画面のみ -->
  <div class="pw-screen" id="pwScreen">
    <div class="row locked" id="pwRow">
      <input id="pwInput" type="password" placeholder="パスワード">
      <button class="go" id="goBtn">進む</button>
    </div>
    <div class="msg" id="msg"></div>
  </div>

  <!-- 動画 -->
  <div class="stage" id="videoStage">
    <video id="introVideo" playsinline preload="auto">
      <source src="../../assets/intro_1700000000.mp4" type="video/mp4">
    </video>
    <div class="overlay hidden" id="playOverlay">
      <button class="btn" id="playBtn">▶ 再生</button>
    </div>
  </div>

</div>

<script>
const TARGET_URL="./1700000000.html";
const PASSWORD_HASH="69aa50d0821a77410478ef06b174193c892c210509e13aeec8a8ae6a0225b42a"; //4649

const INITIAL_WAIT=10000;
const BLACKOUT_TIME=2000;

const blackout=document.getElementById("blackout");
const pwScreen=document.getElementById("pwScreen");
const pwRow=document.getElementById("pwRow");
const pwInput=document.getElementById("pwInput");
const goBtn=document.getElementById("goBtn");
const msg=document.getElementById("msg");

const videoStage=document.getElementById("videoStage");
const video=document.getElementById("introVideo");
const overlay=document.getElementById("playOverlay");
const playBtn=document.getElementById("playBtn");

const sleep=ms=>new Promise(r=>setTimeout(r,ms));

function blackoutOn(){blackout.classList.add("show")}
async function blackoutOff(){blackout.classList.remove("show");await sleep(260)}

function unlock(){pwRow.classList.remove("locked");pwInput.focus()}
function lock(){pwRow.classList.add("locked")}

async function start(){
  lock();
  await sleep(INITIAL_WAIT);

  blackoutOn();
  await sleep(BLACKOUT_TIME);

  pwScreen.classList.add("hidden");
  videoStage.classList.add("show");

  try{
    await video.play();
  }catch(e){
    overlay.classList.remove("hidden");
  }

  await blackoutOff();
}

playBtn.addEventListener("click",async()=>{
  overlay.classList.add("hidden");
  await video.play();
});

video.addEventListener("ended",async()=>{
  blackoutOn();
  await sleep(BLACKOUT_TIME);

  videoStage.classList.remove("show");
  pwScreen.classList.remove("hidden");
  unlock();

  await blackoutOff();
});

async function sha256(t){
  const e=new TextEncoder();
  const d=e.encode(t);
  const h=await crypto.subtle.digest("SHA-256",d);
  return Array.from(new Uint8Array(h)).map(b=>b.toString(16).padStart(2,"0")).join("");
}

async function check(){
  if(pwRow.classList.contains("locked")) return;
  const val=pwInput.value;
  if(!val) return;
  const hex=await sha256(val);
  if(hex===PASSWORD_HASH) location.href=TARGET_URL;
  else{msg.textContent="×";pwInput.select();}
}

goBtn.addEventListener("click",check);
pwInput.addEventListener("keydown",e=>{if(e.key==="Enter")check()});

start();
</script>

</body>
</html>
