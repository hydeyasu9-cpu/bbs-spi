<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Access</title>
<style>
/* ===== 2ch-ish base ===== */
:root{
  --bg:#f6f6f6;
  --panel:#ffffff;
  --line:#c9c9c9;
  --text:#111;
  --muted:#555;
  --link:#0645ad;
  --warn:#b00020;
  --btn:#efefef;
  --btnText:#111;
  --btnLine:#9a9a9a;
  --fade:260ms;
}

html,body{ height:100%; }
body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "MS Gothic", "ＭＳ ゴシック", monospace;
  line-height:1.55;
}

/* 中央寄せじゃなく、掲示板っぽく上に置く */
.wrap{
  width:min(980px, calc(100% - 24px));
  margin:16px auto;
}

/* 汎用：完全非表示（動画中にPWを消すのに使う） */
.hidden{ display:none !important; }

.panel{
  margin-top:10px;
  border:1px solid var(--line);
  background:var(--panel);
}

.panel-hd{
  padding:8px 12px;
  border-bottom:1px solid var(--line);
  background:#fafafa;
  font-weight:700;
}
.panel-bd{
  padding:12px;
}

.notice{
  font-size:13px;
  color:var(--text);
}
.notice .title{
  font-weight:700;
}
.notice .desc{
  margin-top:6px;
  color:var(--muted);
}

/* パスワード入力 */
.row{
  display:flex;
  gap:8px;
  align-items:center;
  margin-top:10px;
  flex-wrap:wrap;
}

input{
  flex:1;
  min-width:220px;
  border:1px solid var(--line);
  background:#fff;
  color:var(--text);
  padding:8px 10px;
  font-size:14px;
  border-radius:2px; /* 角丸しない */
}

.go{
  border:1px solid var(--btnLine);
  background:var(--btn);
  color:var(--btnText);
  padding:8px 12px;
  font-size:14px;
  border-radius:2px;
  cursor:pointer;
}
.go:active{ transform:translateY(1px); }

.locked{
  opacity:.45;
  pointer-events:none;
}

.msg{
  margin-top:8px;
  font-size:13px;
  color:var(--warn);
  min-height:1.2em;
}

/* 動画ステージ */
.stage{
  display:none;
  margin-top:10px;
  border:1px solid var(--line);
  background:var(--panel);
}
.stage.show{ display:block; }

.stage-inner{
  position:relative;
}

video{
  width:100%;
  max-height:75vh;
  background:#000;
}

/* 再生オーバーレイ（簡素） */
.overlay{
  position:absolute;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  background:rgba(255,255,255,.85);
}
.overlay.hidden{ display:none; }

.btn{
  border:1px solid var(--btnLine);
  border-radius:2px;
  padding:10px 14px;
  font-size:14px;
  font-weight:700;
  background:var(--btn);
  color:var(--btnText);
  cursor:pointer;
}

.hr{ border-top:1px solid var(--line); margin:10px 0; }
.small{ font-size:12px; color:var(--muted); }

/* ブラックアウト（演出は維持） */
.blackout{
  position:fixed;
  inset:0;
  background:#000;
  opacity:0;
  pointer-events:none;
  transition:opacity var(--fade) ease;
  z-index:9999;
}
.blackout.show{
  opacity:1;
  pointer-events:auto;
}
</style>
</head>
<body>

<div class="blackout" id="blackout"></div>

<div class="wrap">

  <!-- 初期：パスワード画面のみ -->
  <div class="panel pw-screen" id="pwScreen">
    <div class="panel-hd">Access</div>
    <div class="panel-bd">
      <div class="notice">
        <div class="title">入力</div>
        <div class="desc">
          「ワイ氏、超絶大凶と占われるも無事にラッキーアイテムを手に入れて無双www」のスレを閲覧するためにはパスワードを入力してください。
        </div>
      </div>

      <div class="hr"></div>

      <div class="row locked" id="pwRow">
        <input id="pwInput" type="password" placeholder="パスワード">
        <button class="go" id="goBtn">OK</button>
        <span class="small">（Enterでも可）</span>
      </div>

      <div class="msg" id="msg"></div>
    </div>
  </div>

  <!-- 動画 -->
  <div class="stage" id="videoStage">
    <div class="panel-hd"></div>
    <div class="stage-inner">
      <video id="introVideo" playsinline preload="auto">
        <source src="../../assets/intro_1700000000.mp4" type="video/mp4">
      </video>
      <div class="overlay hidden" id="playOverlay">
        <button class="btn" id="playBtn">▶ 再生</button>
      </div>
    </div>
  </div>

</div>

<script>
const TARGET_URL="./1700000000.html";
const PASSWORD_HASH="69aa50d0821a77410478ef06b174193c892c210509e13aeec8a8ae6a0225b42a"; //4649

const INITIAL_WAIT=10000;
const BLACKOUT_TIME=2000;

const blackout=document.getElementById("blackout");
const pwScreen=document.getElementById("pwScreen");
const pwRow=document.getElementById("pwRow");
const pwInput=document.getElementById("pwInput");
const goBtn=document.getElementById("goBtn");
const msg=document.getElementById("msg");

const videoStage=document.getElementById("videoStage");
const video=document.getElementById("introVideo");
const overlay=document.getElementById("playOverlay");
const playBtn=document.getElementById("playBtn");

const sleep=ms=>new Promise(r=>setTimeout(r,ms));

function blackoutOn(){ blackout.classList.add("show"); }
async function blackoutOff(){ blackout.classList.remove("show"); await sleep(260); }

function unlock(){ pwRow.classList.remove("locked"); pwInput.focus(); }
function lock(){ pwRow.classList.add("locked"); }

async function start(){
  lock();
  await sleep(INITIAL_WAIT);

  blackoutOn();
  await sleep(BLACKOUT_TIME);

  // 動画開始時：PW画面は完全に消す（同居させない）
  pwScreen.classList.add("hidden");
  videoStage.classList.add("show");

  try{
    await video.play();
  }catch(e){
    overlay.classList.remove("hidden");
  }

  await blackoutOff();
}

playBtn.addEventListener("click", async ()=>{
  overlay.classList.add("hidden");
  await video.play();
});

video.addEventListener("ended", async ()=>{
  blackoutOn();
  await sleep(BLACKOUT_TIME);

  videoStage.classList.remove("show");
  pwScreen.classList.remove("hidden");
  unlock();

  await blackoutOff();
});

async function sha256(t){
  const e=new TextEncoder();
  const d=e.encode(t);
  const h=await crypto.subtle.digest("SHA-256", d);
  return Array.from(new Uint8Array(h)).map(b=>b.toString(16).padStart(2,"0")).join("");
}

async function check(){
  if(pwRow.classList.contains("locked")) return;
  const val=pwInput.value;
  if(!val) return;

  const hex=await sha256(val);
  if(hex===PASSWORD_HASH){
    location.href=TARGET_URL;
  }else{
    msg.textContent="パスワードが違います。";
    pwInput.select();
  }
}

goBtn.addEventListener("click", check);
pwInput.addEventListener("keydown", e=>{ if(e.key==="Enter") check(); });

start();
</script>

</body>
</html>
