<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Access</title>

<style>
:root{
  --bg:#f6f6f6;
  --panel:#ffffff;
  --line:#c9c9c9;
  --text:#111;
  --warn:#b00020;
  --btn:#efefef;
  --btnLine:#9a9a9a;
  --fade:260ms;
}
html,body{height:100%;margin:0;}
body{
  background:var(--bg);
  color:var(--text);
  font-family: ui-monospace, Menlo, Consolas, "MS Gothic", monospace;
  display:flex; justify-content:center; align-items:center;
}
.wrap{ width:min(900px,95%); }
.hidden{ display:none !important; }

.panel{ border:1px solid var(--line); background:var(--panel); }
.panel-hd{ padding:8px 12px; border-bottom:1px solid var(--line); background:#fafafa; font-weight:700; }
.panel-bd{ padding:16px; }

.row{ display:flex; gap:8px; margin-top:16px; }
input{ flex:1; border:1px solid var(--line); padding:8px; font-size:14px; }
.go{ border:1px solid var(--btnLine); background:var(--btn); padding:8px 14px; cursor:pointer; }
.locked{ opacity:.5; pointer-events:none; }
.msg{ margin-top:10px; color:var(--warn); font-size:13px; }

.stage{ display:none; width:100%; }
.stage.show{ display:block; }

.stage-inner{ position:relative; }
video{ width:100%; max-height:80vh; background:#000; }

/* éŸ³ONãƒœã‚¿ãƒ³ */
.soundOverlay{
  position:absolute;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  background:rgba(0,0,0,.35);
}
.soundOverlay.hidden{ display:none; }
.soundBtn{
  border:1px solid var(--btnLine);
  background:var(--btn);
  padding:10px 14px;
  font-weight:700;
  cursor:pointer;
}

.blackout{
  position:fixed; inset:0; background:#000;
  opacity:0; pointer-events:none;
  transition:opacity var(--fade) ease;
  z-index:9999;
}
.blackout.show{ opacity:1; pointer-events:auto; }
</style>
</head>

<body>
<div class="blackout" id="blackout"></div>

<div class="wrap">

  <!-- ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç”»é¢ -->
  <div class="panel" id="pwScreen">
    <div class="panel-hd">Access</div>
    <div class="panel-bd">
      ã€Œãƒ¯ã‚¤æ°ã€è¶…çµ¶å¤§å‡¶ã¨å ã‚ã‚Œã‚‹ã‚‚ç„¡äº‹ã«ãƒ©ãƒƒã‚­ãƒ¼ã‚¢ã‚¤ãƒ†ãƒ ã‚’æ‰‹ã«å…¥ã‚Œã¦ç„¡åŒwwwã€ã®ã‚¹ãƒ¬ã‚’é–²è¦§ã™ã‚‹ãŸã‚ã«ã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚

      <div class="row locked" id="pwRow">
        <input id="pwInput" type="password" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰">
        <button class="go" id="goBtn">OK</button>
      </div>

      <div class="msg" id="msg"></div>
    </div>
  </div>

  <!-- å‹•ç”» -->
  <div class="stage" id="videoStage">
    <div class="stage-inner">
      <!-- è‡ªå‹•å†ç”Ÿã‚’é€šã™ãŸã‚æœ€åˆã¯ muted -->
      <video id="introVideo" autoplay muted playsinline preload="auto">
        <source src="../../assets/intro_1700000000.mp4" type="video/mp4">
      </video>

      <!-- 1ã‚¿ãƒƒãƒ—ã§éŸ³ã‚’å‡ºã™ -->
      <div class="soundOverlay" id="soundOverlay">
        <button class="soundBtn" id="soundBtn">ğŸ”Š éŸ³ã‚’å‡ºã™</button>
      </div>
    </div>
  </div>

</div>

<script>
const TARGET_URL="./1700000000.html";
const PASSWORD_HASH="69aa50d0821a77410478ef06b174193c892c210509e13aeec8a8ae6a0225b42a"; //4649

const INITIAL_WAIT=10000;
const BLACKOUT_TIME=2000;

const blackout=document.getElementById("blackout");
const pwScreen=document.getElementById("pwScreen");
const pwRow=document.getElementById("pwRow");
const pwInput=document.getElementById("pwInput");
const goBtn=document.getElementById("goBtn");
const msg=document.getElementById("msg");

const videoStage=document.getElementById("videoStage");
const video=document.getElementById("introVideo");
const soundOverlay=document.getElementById("soundOverlay");
const soundBtn=document.getElementById("soundBtn");

const sleep=ms=>new Promise(r=>setTimeout(r,ms));

function blackoutOn(){ blackout.classList.add("show"); }
async function blackoutOff(){ blackout.classList.remove("show"); await sleep(260); }

function unlock(){ pwRow.classList.remove("locked"); pwInput.focus(); }
function lock(){ pwRow.classList.add("locked"); }

async function start(){
  lock();
  await sleep(INITIAL_WAIT);

  blackoutOn();
  await sleep(BLACKOUT_TIME);

  pwScreen.classList.add("hidden");
  videoStage.classList.add("show");

  // ã“ã“ã§è‡ªå‹•å†ç”Ÿï¼ˆmutedï¼‰ã‚’ç¢ºå®Ÿã«é–‹å§‹
  video.play().catch(()=>{});

  await blackoutOff();
}

// éŸ³ã‚’å‡ºã™ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œï¼‰
async function enableSound(){
  try{
    video.muted = false;
    video.volume = 1.0;
    await video.play();
    soundOverlay.classList.add("hidden");
  }catch(e){
    // å¤±æ•—ã—ã¦ã‚‚ãƒœã‚¿ãƒ³æ®‹ã™
  }
}
soundBtn.addEventListener("click", enableSound);
// ã‚¹ãƒãƒ›ã§æŠ¼ã—ã‚„ã™ã„ã‚ˆã†ã«èƒŒæ™¯ã‚¯ãƒªãƒƒã‚¯ã§ã‚‚æœ‰åŠ¹åŒ–
soundOverlay.addEventListener("click", (e)=>{ if(e.target === soundOverlay) enableSound(); });

video.addEventListener("ended", async ()=>{
  blackoutOn();
  await sleep(BLACKOUT_TIME);

  videoStage.classList.remove("show");
  pwScreen.classList.remove("hidden");
  unlock();

  await blackoutOff();
});

async function sha256(t){
  const e=new TextEncoder();
  const d=e.encode(t);
  const h=await crypto.subtle.digest("SHA-256", d);
  return Array.from(new Uint8Array(h)).map(b=>b.toString(16).padStart(2,"0")).join("");
}

async function check(){
  if(pwRow.classList.contains("locked")) return;
  const val=pwInput.value;
  if(!val) return;

  const hex=await sha256(val);
  if(hex===PASSWORD_HASH){
    location.href=TARGET_URL;
  }else{
    msg.textContent="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé•ã„ã¾ã™ã€‚";
    pwInput.select();
  }
}

goBtn.addEventListener("click",check);
pwInput.addEventListener("keydown",e=>{ if(e.key==="Enter") check(); });

start();
</script>

</body>
</html>
